<!DOCTYPE html>
<html>
<head>
    <title>JetBot Gamepad Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .top-section {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .video-feed {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 10px;
        }
        .video-feed img {
            width: 100%;
            max-width: 300px;
            border-radius: 5px;
        }
        .header {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 10px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .status-item {
            background: #333;
            padding: 8px;
            border-radius: 5px;
        }
        .status-label { font-size: 10px; color: #999; }
        .status-value { font-size: 16px; font-weight: bold; margin-top: 3px; }
        .motor-viz {
            height: 40px;
            background: #222;
            border-radius: 3px;
            position: relative;
            margin-top: 5px;
        }
        .motor-bar {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #4CAF50, #8BC34A);
            border-radius: 3px;
            transition: height 0.1s, background 0.2s;
        }
        .motor-bar.negative {
            background: linear-gradient(to top, #f44336, #e57373);
        }
        .photos-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .photo-column {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .photo-item {
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 5px;
            background: #333;
            position: relative;
        }
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 8px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .photo-item:hover .delete-btn {
            opacity: 1;
        }
        .delete-btn:hover {
            background: rgba(244, 67, 54, 1);
        }
        .message {
            background: #333;
            padding: 8px;
            border-radius: 5px;
            margin-top: 8px;
            font-size: 11px;
        }
        h1 { margin: 0 0 10px 0; font-size: 18px; }
        .connected { color: #4CAF50; }
        .disconnected { color: #f44336; }
        h2 { margin-top: 0; display: inline-block; }
        .delete-all-btn {
            float: right;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
        }
        .delete-all-btn:hover {
            background: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-section">
            <div class="video-feed">
                <h1>üìπ Live Camera Feed</h1>
                <img src="/video_feed" alt="Live Feed" />
            </div>
            <div class="header">
                <h1>üéÆ Status</h1>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">Gamepad</div>
                        <div class="status-value" id="gamepad-status">-</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Camera</div>
                        <div class="status-value" id="camera-status">-</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Left Photos</div>
                        <div class="status-value" id="left-count">0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Right Photos</div>
                        <div class="status-value" id="right-count">0</div>
                    </div>
                </div>
                <div class="status-grid" style="margin-top: 8px;">
                    <div class="status-item">
                        <div class="status-label">Left Motor</div>
                        <div class="motor-viz">
                            <div class="motor-bar" id="left-motor-bar"></div>
                        </div>
                        <div style="text-align: center; margin-top: 3px; font-size: 11px;" id="left-motor-val">0.00</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Right Motor</div>
                        <div class="motor-viz">
                            <div class="motor-bar" id="right-motor-bar"></div>
                        </div>
                        <div style="text-align: center; margin-top: 3px; font-size: 11px;" id="right-motor-val">0.00</div>
                    </div>
                </div>
                <div class="message" id="message">Waiting...</div>
            </div>
        </div>

        <div class="photos-section">
            <div class="photo-column">
                <h2>‚¨ÖÔ∏è Left Photos</h2>
                <button class="delete-all-btn" onclick="deleteAll('left')">üóëÔ∏è Delete All Left</button>
                <div style="clear: both;"></div>
                <div class="photo-grid" id="left-photos"></div>
            </div>
            <div class="photo-column">
                <h2>‚û°Ô∏è Right Photos</h2>
                <button class="delete-all-btn" onclick="deleteAll('right')">üóëÔ∏è Delete All Right</button>
                <div style="clear: both;"></div>
                <div class="photo-grid" id="right-photos"></div>
            </div>
        </div>
    </div>

    <script>
        function updateStatus() {
            fetch('/api/status')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('gamepad-status').innerHTML =
                        data.gamepad_connected ?
                        `<span class="connected">‚úì ${data.gamepad_name}</span>` :
                        '<span class="disconnected">‚úó Not connected</span>';

                    document.getElementById('camera-status').innerHTML =
                        data.camera_available ?
                        '<span class="connected">‚úì Ready</span>' :
                        '<span class="disconnected">‚úó Not available</span>';

                    document.getElementById('left-count').textContent = data.left_count;
                    document.getElementById('right-count').textContent = data.right_count;
                    document.getElementById('message').textContent = data.message;

                    // Update motor visualizations
                    const leftPct = Math.abs(data.left_motor) * 100;
                    const rightPct = Math.abs(data.right_motor) * 100;
                    const leftBar = document.getElementById('left-motor-bar');
                    const rightBar = document.getElementById('right-motor-bar');

                    leftBar.style.height = leftPct + '%';
                    rightBar.style.height = rightPct + '%';

                    // Add/remove negative class for color change
                    if (data.left_motor < 0) {
                        leftBar.classList.add('negative');
                    } else {
                        leftBar.classList.remove('negative');
                    }

                    if (data.right_motor < 0) {
                        rightBar.classList.add('negative');
                    } else {
                        rightBar.classList.remove('negative');
                    }

                    document.getElementById('left-motor-val').textContent = data.left_motor.toFixed(2);
                    document.getElementById('right-motor-val').textContent = data.right_motor.toFixed(2);
                });
        }

        function deletePhoto(side, filename) {
            fetch(`/api/delete/${side}/${filename}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'deleted') {
                        loadPhotos(side);
                    } else {
                        alert('Error deleting photo: ' + (data.error || 'Unknown error'));
                    }
                });
        }

        function deleteAll(side) {
            const sideName = side === 'left' ? 'LEFT' : 'RIGHT';
            if (!confirm(`Delete ALL ${sideName} photos? This cannot be undone!`)) return;

            fetch(`/api/delete-all/${side}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'deleted') {
                        loadPhotos(side);
                        alert(`Deleted ${data.count} ${sideName} photos`);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                });
        }

        function loadPhotos(side) {
            fetch(`/api/photos/${side}`)
                .then(r => r.json())
                .then(data => {
                    const grid = document.getElementById(`${side}-photos`);
                    grid.innerHTML = data.photos.map(photo =>
                        `<div class="photo-item">
                            <img src="/photos/${side}/${photo}" alt="${photo}"
                                 onclick="window.open(this.src, '_blank')">
                            <button class="delete-btn" onclick="event.stopPropagation(); deletePhoto('${side}', '${photo}')">‚úï</button>
                        </div>`
                    ).join('');
                });
        }

        // Update status every 500ms (reduced from 100ms to minimize logs)
        setInterval(updateStatus, 500);

        // Update photos every 3 seconds
        setInterval(() => {
            loadPhotos('left');
            loadPhotos('right');
        }, 3000);

        // Initial load
        updateStatus();
        loadPhotos('left');
        loadPhotos('right');
    </script>
</body>
</html>